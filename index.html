<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Asistente Diario PRO - Versi√≥n Unificada (Cloud + Funciones Avanzadas)</title>
<style>
	/* Dise√±o Base */
	body {	
		font-family: Arial, sans-serif;	
		margin: 20px auto;	
		background: #f4f4f4;	
		max-width: 1200px;	
		padding: 0 20px;	
	}

	h1 { color: #333; }
	.section { margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 8px; }
	input, textarea, select { margin: 5px 0; padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 4px; }
	
	/* === ESTILOS PARA EL ENCABEZADO Y BOT√ìN SALIR === */
	.header-container {
		display: flex;	
		justify-content: space-between;	
		align-items: center;	
		margin-bottom: 10px;	
	}
	.logout-btn {
		background: #d32f2f; /* Rojo para el bot√≥n de salir */
		font-weight: bold;
		padding: 8px 12px;
	}
	.logout-btn:hover {
		opacity: 0.8;
	}
	/* ======================================================= */

	/* Estilo para el bot√≥n de Google (Login) */
	.google-btn {	
		padding: 10px 15px;	
		margin: 5px 5px 0 0;	
		border: none;	
		border-radius: 5px;	
		cursor: pointer;	
		background: #db4437; /* Rojo de Google */
		color: white;	
		font-weight: bold;
	}
	.google-btn:hover { opacity: 0.9; }
	
	/* Estilo para los botones generales */
	button { padding: 10px 15px; margin: 5px 5px 0 0; border: none; border-radius: 5px; cursor: pointer; background: #1976d2; color: white; }
	button:hover { opacity: 0.9; }
	
	/* MODIFICACI√ìN CLAVE: REGLAS PARA EL SCROLL EN LA LISTA UL */
	ul {	
		list-style-type: none;	
		padding: 0;	
		max-height: 400px; /* Altura m√°xima de la lista */
		overflow-y: auto;	 /* Habilita el scroll vertical */
		border: 1px solid #ccc; /* Borde para delimitar el √°rea con scroll */
		padding-right: 10px; /* Espacio para el scroll */
	}

	li {	
		margin: 5px 0;	
		padding: 10px; /* Aumentado padding para mejor toque en m√≥vil */
		background: #eaeaea;	
		border-radius: 5px;	
		cursor: pointer;	
		white-space: normal;
		transition: background-color 0.3s, box-shadow 0.3s;
	}
	.completed {	
		text-decoration: line-through;	
		color: gray;	
		background: #f1f1f1;	
	}
	.calendar { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }	
	.day { background: #ddd; padding: 10px; border-radius: 5px; min-height: 60px; }
	
	.current-day {
		background-color: #b0b0b0 !important;
		border: 2px solid #555;
	}
	
	.stats { font-weight: bold; margin-top: 10px; }
	
	.task-buttons {	
		display: flex;	
		gap: 10px;	
		flex-wrap: wrap;	
		margin-top: 10px;	
		align-items: flex-start;
		justify-content: space-between;	
	}
	
	.urgent-tag {
		color: red;
		font-weight: bold;
	}

	/* Estilos para Etiqueta y Fecha lado a lado*/
	.task-inputs-row {
		display: flex;	
		gap: 10px; 	
		margin: 5px 0 10px 0;	
	}

	.task-inputs-row select,
	.task-inputs-row input[type="date"] {
		width: 50%;	
		margin: 0; 	
	}

	/* ESTILOS DEL BANNER DE ALERTA */
	.alert-banner {
		padding: 15px;
		margin-bottom: 20px;
		border: 1px solid transparent;
		border-radius: 4px;
		color: #856404;	
		background-color: #fff3cd;	
		border-color: #ffeeba;	
		font-weight: bold;
		display: flex;
		justify-content: space-between;
		align-items: flex-start;	
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
	}
	.alert-banner button {
		background: transparent;
		color: #856404;
		border: none;
		padding: 5px 10px;
		cursor: pointer;
		font-weight: bold;
		font-size: 1.2em;
		margin-left: 15px;
		line-height: 1;
	}
	.alert-banner button:hover {
		opacity: 0.7;
	}
	.task-list-summary {
		font-size: 0.9em;
		margin-top: 5px;
		white-space: pre-wrap;	
		font-weight: normal;	
	}

	.tomorrow-task {
		font-weight: bold;
		color: orange;
	}

	/* === ESTILOS PARA EL TIME TRACKING ACTIVO (1.2) === */
	@keyframes pulse-active {
		0% { box-shadow: 0 0 5px rgba(56, 142, 60, 0.4); }
		50% { box-shadow: 0 0 10px rgba(56, 142, 60, 0.8); }
		100% { box-shadow: 0 0 5px rgba(56, 142, 60, 0.4); }
	}
	.task-running {
		background-color: #e8f5e9 !important; /* Verde muy claro */
		border: 2px solid #388e3c; /* Borde verde oscuro */
		animation: pulse-active 2s infinite;
	}
	/* ======================================================= */

	/* === MEDIA QUERIES PARA RESPONSIVIDAD (Paso 2) === */
	@media (max-width: 768px) {
		body {
			padding: 0 10px; /* Reduce padding lateral */
		}
	 	
		/* 1. LAYOUT PRINCIPAL */
		.header-container {
			flex-direction: column; /* Apila el t√≠tulo y el bot√≥n Salir */
			align-items: flex-start;
		}
		.header-container h1 {
			font-size: 1.5em;
		}

		/* 2. TAREAS Y CONTROLES */
		.task-inputs-row {
			flex-direction: column; /* Apila Etiqueta y Fecha */
			gap: 0;
		}
		.task-inputs-row select,
		.task-inputs-row input[type="date"] {
			width: 100%; /* Ocupan todo el ancho */
			margin-bottom: 5px;
		}

		/* 3. BOTONES DE ACCI√ìN */
		.task-buttons {
			flex-direction: column; /* Apila los grupos de botones */
			gap: 15px;	
		}

		/* 4. LISTA DE TAREAS (LI) - Crucial para botones */
		#taskList li > div {
			flex-direction: column; /* Apila el texto y los botones */
			align-items: flex-start;
		}
		#taskList li span {
			margin-bottom: 5px; /* Espacio despu√©s del texto de la tarea */
			display: block;
			width: 100%; /* Asegura que ocupe todo el ancho para el tap */
			cursor: pointer;
		}
		#taskList li > div > div {
			/* Contenedor de botones (Editar, Iniciar/Detener, Eliminar) */
			display: flex;
			flex-wrap: wrap; /* Envuelve los botones si no caben */
			margin-top: 5px;
			width: 100%;
		}
		#taskList li > div > div button {
			margin: 3px 5px 3px 0; /* Espaciado m√°s compacto */
		}
	 	
		/* 5. CALENDARIO */
		.calendar {
			grid-template-columns: repeat(3, 1fr); /* Muestra 3 columnas en lugar de 5 en m√≥vil */
		}
		.day {
			min-height: 80px; /* Aumenta un poco la altura para el tacto */
			padding: 5px;
		}
	 	
		/* 6. BANNER DE ALERTA */
		.alert-banner {
			flex-direction: column;
		}
		.alert-banner button {
			align-self: flex-start; /* Alinea el bot√≥n de cerrar */
			margin-left: 0;
			margin-top: 5px;
		}

		/* 7. FILTROS R√ÅPIDOS y ORDENACI√ìN */
		#filterButtons {
			flex-direction: column;
		}
		#filterButtons button {
			width: 100%;
			margin: 3px 0;
		}
		#sortSelector {
			width: 100% !important;
			max-width: none !important;
		}
	}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>

<div id="loginSection" class="section" style="display: block;">
	<p>Inicia sesi√≥n con Google para acceder a tu Asistente Diario PRO.</p>
	<button id="google-login-btn" class="google-btn" onclick="signInWithGoogle()">
		<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/48px-Google_%22G%22_logo.svg.png" alt="Google Logo" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 8px;">
		Iniciar sesi√≥n con Google
	</button>
	<p id="authMessage" style="color: gray;">Esperando inicio de sesi√≥n...</p>
</div>

<div id="mainContent" style="display: none;">

	<div class="header-container">
		<h1 id="userWelcome">Asistente Diario PRO</h1>
		<button class="logout-btn" onclick="signOutUser()">üëã Cerrar Sesi√≥n</button>
	</div>

	<div id="upcomingTasksBanner" style="display: none;" class="alert-banner">
	</div>
	
	<p id="fecha-hora"></p>

	<div class="section">
		<h2>‚úÖ Tareas</h2>
		<input id="taskInput" placeholder="Escribe una tarea..." type="text"/>
		
		<div class="task-inputs-row">
			<select id="taskTag">
				<option value="">Sin Etiqueta</option>
				<option value="Urgente">Urgente</option>
				<option value="Reuni√≥n">Reuni√≥n</option>
				<option value="Personal">Personal</option>
				<option value="Desarrollo">Desarrollo</option>
				<option value="Otro">Otro</option>
			</select>
			<input id="taskDate" type="date"/>
		</div>
		
		<div class="task-buttons">
			<div style="display: flex; gap: 10px; flex-wrap: wrap;">
				<button id="addTaskBtn" onclick="addTask()">‚ûï Agregar tarea</button>
				<button onclick="clearForm()">üßπ Limpiar formulario</button>
			</div>
			<div style="display: flex; gap: 10px; flex-wrap: wrap;">
				<button onclick="startDictation()">üéôÔ∏è Comenzar dictado</button>
			</div>
		</div>
		
		<p id="statusMessage" style="color: blue;">Esperando inicio de sesi√≥n...</p>
		
		<div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
			<label for="sortSelector" style="font-weight: bold; white-space: nowrap;">Ordenar por:</label>
			<select id="sortSelector" style="width: auto; max-width: 200px;" onchange="renderTasks()">
				<option value="default">Fecha de Creaci√≥n (M√°s nuevo primero)</option>
				<option value="dateAsc">Fecha L√≠mite (M√°s cercana primero)</option>
				<option value="dateDesc">Fecha L√≠mite (M√°s lejana primero)</option>
				<option value="tagPriority">Etiqueta (Urgente primero)</option>
			</select>
		</div>

		<div class="task-buttons" id="filterButtons">
			<div style="display: flex; gap: 10px; flex-wrap: wrap;">
				<button onclick="filterTasks('')" id="filter-Todos">
					Mostrar Todos
				</button>
				<button 
					onclick="filterTasks('Urgente')"
					id="filter-Urgente">
					Urgente
				</button>
				<button 
					onclick="filterTasks('Reuni√≥n')"
					id="filter-Reuni√≥n">
					Reuni√≥n
				</button>
				<button 
					onclick="filterTasks('Personal')"
					id="filter-Personal">
					Personal
				</button>
				<button 
					onclick="filterTasks('Desarrollo')"
					id="filter-Desarrollo">
					Desarrollo
				</button>
				<button 
					onclick="filterTasks('Otro')"
					id="filter-Otro">
					Otro
				</button>
			</div>
			<div style="display: flex; gap: 10px; flex-wrap: wrap;">
				<button onclick="clearAllCompletedTasks()" style="background: #e64a19;">‚ùå Eliminar tareas completadas</button>
				<button onclick="generatePDFReport()" style="background: #00796b;">üìÑ Generar Reporte PDF</button>
			</div>
		</div>

		<div class="stats">
			<p>Tareas completadas hoy: <span id="completedToday">0</span></p>
			<p>Tiempo total de seguimiento: <span id="totalTimeTracked">0h 0m</span> (en <span id="tasksWithTimeCount">0</span> tareas)</p>
		</div>
		
		<ul id="taskList">
			</ul>
	</div>

	<div class="section">
		<h2>üìÖ Resumen Semanal</h2>
		<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
			<button onclick="changeMonth(-1)">&#9664; Mes Anterior</button>
			<h3 id="calendarTitle"></h3>
			<button onclick="changeMonth(1)">Mes Siguiente &#9654;</button>
		</div>
		<div id="calendar" class="calendar">
			</div>
	</div>

	<div id="historySection" class="section">
		<h2>üóëÔ∏è Historial de Tareas Completadas (√öltimas 5)</h2>
		<ul id="completedTasksList">
			</ul>
	</div>

</div>

<script>
	// ----------------------------------------------------------------------
	// ‚öôÔ∏è CONFIGURACI√ìN DE FIREBASE ‚öôÔ∏è
	// ----------------------------------------------------------------------
	// INSERTA AQU√ç TUS PROPIAS CREDENCIALES
	const firebaseConfig = {
		// ... [Tus credenciales de Firebase]
	};

	// Inicializar Firebase
	if (!firebase.apps.length) {
		firebase.initializeApp(firebaseConfig);
	}

	const db = firebase.firestore();
	const auth = firebase.auth();
	const tasksCollection = db.collection("tareas_pro");
	
	// Variables globales
	let tasks = [];
	let currentUser = null;
	let editingTaskId = null;
	let currentFilter = '';
	const WEEK_DAYS = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
	let currentCalendarDate = new Date(); // Para el calendario
	const TAG_PRIORITY = { 'Urgente': 3, 'Reuni√≥n': 2, 'Personal': 1, 'Desarrollo': 1, 'Otro': 0, '': 0 }; // Para ordenar por prioridad
	
	// Variables del Time Tracker
	let timerUpdateInterval; // El intervalo que se ejecuta cada segundo para actualizar el tiempo en pantalla
	
	// ----------------------------------------------------------------------
	// üíª ELEMENTOS DOM üíª
	// ----------------------------------------------------------------------
	const loginSection = document.getElementById('loginSection');
	const mainContent = document.getElementById('mainContent');
	const authMessage = document.getElementById('authMessage');
	const statusMessage = document.getElementById('statusMessage');

	// ----------------------------------------------------------------------
	// üíª FUNCIONES AUXILIARES üíª
	// ----------------------------------------------------------------------
	
	/**
	 * Formatea una fecha ISO (YYYY-MM-DD) a un formato legible (DD/MM/YYYY)
	 * @param {string} isoDate La fecha en formato ISO
	 * @returns {string} La fecha en formato DD/MM/YYYY
	 */
	function formatDateToDisplay(isoDate) {
		if (!isoDate) return 'Sin fecha';
		const [year, month, day] = isoDate.split('-');
		return `${day}/${month}/${year}`;
	}
	
	/**
	 * Formatea un n√∫mero de milisegundos a un string de horas, minutos y segundos.
	 * @param {number} ms Milisegundos de tiempo transcurrido.
	 * @returns {string} Tiempo en formato Hh Mm Ss.
	 */
	function formatTime(ms) {
		const totalSeconds = Math.floor(ms / 1000);
		const hours = Math.floor(totalSeconds / 3600);
		const minutes = Math.floor((totalSeconds % 3600) / 60);
		const seconds = totalSeconds % 60;
		
		let timeString = '';
		if (hours > 0) timeString += `${hours}h `;
		if (minutes > 0 || hours > 0) timeString += `${minutes}m `;
		timeString += `${seconds}s`;
		
		return timeString.trim();
	}
	
	/**
	 * Obtiene la fecha de hoy en formato YYYY-MM-DD para el input[type="date"]
	 */
	function getTodayDateStrForInput() {
		const today = new Date();
		const day = String(today.getDate()).padStart(2, '0');
		const month = String(today.getMonth() + 1).padStart(2, '0'); // Enero es 0
		const year = today.getFullYear();
		return `${year}-${month}-${day}`;
	}
	
	/**
	 * Inicializa el input de fecha a la fecha actual y establece el m√≠nimo.
	 */
	function initializeDateInput() {
		const todayStr = getTodayDateStrForInput();
		const taskDateInput = document.getElementById('taskDate');
		
		// 1. Establece el valor por defecto a la fecha actual
		taskDateInput.value = todayStr;
		
		// 2. Establece la fecha m√≠nima seleccionable a la fecha actual
		taskDateInput.min = todayStr;
	}
	
	// ----------------------------------------------------------------------
	// üíæ FUNCIONES DE DATOS (CLOUD Y LOCAL) üíæ
	// ----------------------------------------------------------------------
	
	/**
	 * Carga los datos de las tareas desde Firestore o Local Storage.
	 */
	async function loadData() {
		if (currentUser) {
			// Carga desde Firestore
			try {
				const doc = await tasksCollection.doc(currentUser.uid).get();
				if (doc.exists) {
					tasks = doc.data().tasks || [];
					tasks = tasks.map(task => {
						// Asegurar que las nuevas propiedades existan para evitar errores
						if (typeof task.elapsedTime === 'undefined') task.elapsedTime = 0;
						if (typeof task.startTime === 'undefined') task.startTime = null;
						return task;
					});
				} else {
					// Si no existe el documento, se inicializa la lista
					tasks = [];
				}
				statusMessage.style.color = 'green';
				statusMessage.innerText = '‚úÖ Tareas cargadas desde la nube.';
			} catch (error) {
				console.error("Error al cargar las tareas desde Firestore:", error);
				statusMessage.style.color = 'red';
				statusMessage.innerText = '‚ùå Error al cargar tareas desde la nube. Revisa la consola.';
			}
		} else {
			// Carga desde Local Storage (fallback o modo no logueado)
			const storedTasks = localStorage.getItem('tasks');
			tasks = storedTasks ? JSON.parse(storedTasks) : [];
			statusMessage.style.color = 'orange';
			statusMessage.innerText = '‚ö†Ô∏è Tareas cargadas desde Local Storage.';
		}
		
		// Despu√©s de cargar, renderizar y actualizar el calendario
		renderTasks();
		renderCalendar();
		updateDateTime();
	}
	
	/**
	 * Guarda los datos de las tareas en Firestore o Local Storage.
	 */
	function saveData() {
		if (currentUser) {
			// Guardar en Firestore
			tasksCollection.doc(currentUser.uid).set({ tasks: tasks })
				.then(() => {
					// console.log("Datos guardados en Firestore.");
				})
				.catch((error) => {
					console.error("Error al guardar en Firestore:", error);
				});
		} else {
			// Guardar en Local Storage
			localStorage.setItem('tasks', JSON.stringify(tasks));
		}
	}
	
	// ----------------------------------------------------------------------
	// ‚è±Ô∏è FUNCIONES DEL TIME TRACKER ‚è±Ô∏è
	// ----------------------------------------------------------------------
	
	/**
	 * Inicia el intervalo de actualizaci√≥n global para los timers de tareas.
	 */
	function startTimerInterval() {
		if (timerUpdateInterval) {
			clearInterval(timerUpdateInterval);
		}
		// Se actualiza el tiempo cada segundo para las tareas en ejecuci√≥n
		timerUpdateInterval = setInterval(() => {
			// Solo renderizamos si hay alguna tarea corriendo
			if (tasks.some(t => t.startTime !== null)) {
				renderTasks(true); // El 'true' indica que es una actualizaci√≥n silenciosa de tiempo
				saveData(); // Guardamos el progreso del tiempo cada segundo
			}
		}, 1000);
	}
	
	/**
	 * Funci√≥n principal para iniciar o detener el cron√≥metro de una tarea.
	 * @param {string} taskId El ID de la tarea
	 */
	function toggleTimer(taskId) {
		const taskIndex = tasks.findIndex(t => t.id === taskId);
		if (taskIndex === -1) return;
		
		const task = tasks[taskIndex];
		const now = Date.now();
		
		if (task.startTime) {
			// 1. DETENER CRON√ìMETRO: Calcular tiempo transcurrido
			const elapsed = now - task.startTime;
			task.elapsedTime = (task.elapsedTime || 0) + elapsed;
			task.startTime = null; // Detener
			statusMessage.style.color = 'gray';
			statusMessage.innerText = `‚è±Ô∏è Cron√≥metro de tarea #${taskIndex + 1} detenido.`;
		} else {
			// 2. INICIAR CRON√ìMETRO:
			// Detener cualquier otra tarea que est√© corriendo
			tasks.forEach(t => {
				if (t.startTime && t.id !== taskId) {
					t.elapsedTime = (t.elapsedTime || 0) + (now - t.startTime);
					t.startTime = null;
				}
			});
			
			// Iniciar la tarea seleccionada
			task.startTime = now;
			statusMessage.style.color = '#388e3c'; // Verde
			statusMessage.innerText = `‚ñ∂Ô∏è Cron√≥metro de tarea #${taskIndex + 1} iniciado.`;
		}
		
		saveData();
		renderTasks();
		startTimerInterval(); // Asegurar que el intervalo est√© corriendo
	}
	
	/**
	 * Calcula el tiempo total invertido en todas las tareas.
	 */
	function calculateTotalTime() {
		let totalMs = 0;
		let tasksWithTime = 0;
		
		tasks.forEach(task => {
			let currentElapsedTime = task.elapsedTime || 0;
			
			// Si la tarea est√° corriendo, a√±ade el tiempo transcurrido desde startTime
			if (task.startTime) {
				const now = Date.now();
				const elapsedSinceStart = now - task.startTime;
				currentElapsedTime += elapsedSinceStart;
			}
			
			totalMs += currentElapsedTime;
			
			if (currentElapsedTime > 0) {
				tasksWithTime++;
			}
		});
		
		document.getElementById('totalTimeTracked').innerText = formatTime(totalMs);
		document.getElementById('tasksWithTimeCount').innerText = tasksWithTime;
	}
	
	// ----------------------------------------------------------------------
	// üí¨ FUNCIONES DEL DICTADO DE VOZ üí¨
	// ----------------------------------------------------------------------

	// --- INICIO DE C√ìDIGO ELIMINADO ---
	// Se eliminan las variables de control del contador de grabaci√≥n.
	// let recordingInterval;
	// let recordingSeconds = 0;
	// --- FIN DE C√ìDIGO ELIMINADO ---
	
	function startDictation() {
		// Verificar soporte
		if (!('webkitSpeechRecognition' in window)) {
			statusMessage.style.color = 'red';
			statusMessage.innerText = '‚ùå Lo sentimos, tu navegador no soporta Dictado de Voz.';
			return;
		}
		
		// Inicializar reconocimiento
		const recognition = new webkitSpeechRecognition();
		recognition.lang = 'es-ES';
		recognition.continuous = false; // Detener despu√©s de la primera pausa
		recognition.interimResults = false;
		
		// Controlar el estado
		recognition.onstart = function() {
			statusMessage.style.color = '#1976d2'; // Azul
			statusMessage.innerText = 'üéôÔ∏è Escuchando... Di tu tarea.';
			
			// --- INICIO DE C√ìDIGO ELIMINADO ---
			// Se elimina la l√≥gica de inicio del contador de grabaci√≥n.
			// document.getElementById('recordingTimer').innerText = "üéôÔ∏è Escuchando...";
			// recordingSeconds = 0; // Reiniciar contador
			// recordingInterval = setInterval(() => {
			// 	recordingSeconds++;
			// 	document.getElementById('recordingTimer').innerText = `üéôÔ∏è Grabando: ${recordingSeconds} segundos`;
			// }, 1000); // Actualiza cada segundo
			// --- FIN DE C√ìDIGO ELIMINADO ---
		};
		
		recognition.onresult = function(event) {
			const transcript = event.results[0][0].transcript;
			document.getElementById('taskInput').value = transcript;
			statusMessage.style.color = 'green';
			statusMessage.innerText = '‚úÖ Dictado finalizado. Texto listo para agregar.';
			
			// --- INICIO DE C√ìDIGO ELIMINADO ---
			// Se elimina la l√≥gica de finalizaci√≥n del contador al obtener el resultado.
			// clearInterval(recordingInterval);
			// document.getElementById('recordingTimer').innerText = `‚è±Ô∏è Texto recibido (${recordingSeconds} segundos)`;
			// --- FIN DE C√ìDIGO ELIMINADO ---
		};
		
		recognition.onerror = function(event) {	
			// --- INICIO DE C√ìDIGO ELIMINADO ---
			// Se elimina la l√≥gica de error y limpieza del contador.
			// clearInterval(recordingInterval);	
			// document.getElementById('recordingTimer').innerText = `‚ùå Error en el dictado: ${event.error}`;
			// --- FIN DE C√ìDIGO ELIMINADO ---
			statusMessage.style.color = 'red';
			statusMessage.innerText = `‚ùå Error en el dictado: ${event.error}`;
		};
		
		recognition.onend = function() {	
			// --- INICIO DE C√ìDIGO ELIMINADO ---
			// Se elimina la l√≥gica de finalizaci√≥n natural y actualizaci√≥n del contador.
			// clearInterval(recordingInterval);	
			// document.getElementById('recordingTimer').innerText = `‚è±Ô∏è Dictado finalizado. ${recordingSeconds} segundos`;
			// --- FIN DE C√ìDIGO ELIMINADO ---
		};
		
		try {
			recognition.start();
		} catch (e) {
			console.error("Error al iniciar el reconocimiento de voz:", e);
			statusMessage.style.color = 'red';
			statusMessage.innerText = '‚ùå Error al intentar iniciar el micr√≥fono. Aseg√∫rate de tener permiso.';
		}
	}

	// ----------------------------------------------------------------------
	// ‚öôÔ∏è FUNCIONES DE MANEJO DE TAREAS (CRUD) ‚öôÔ∏è
	// ----------------------------------------------------------------------
	
	// ... (el resto de las funciones como `addTask`, `clearForm`, `editTask`, `deleteTask`, `toggleComplete`, `renderTasks`, `filterTasks`, `clearAllCompletedTasks`, `generatePDFReport`, `renderHistory`, `cleanUpCompletedTasksBackup` permanecen sin cambios)
	
	// C√ìDIGO OMITIDO POR BREVEDAD, PERO PERMANECE EN TU ARCHIVO
	// ...
</script>

</body>
</html>
