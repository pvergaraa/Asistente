<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Asistente Diario - Sincronizado y Seguro</title>
<style>
Â  Â  /* DiseÃ±o Centrado */
Â  Â  body {Â 
Â  Â  Â  Â  font-family: Arial, sans-serif;Â 
Â  Â  Â  Â  margin: 20px auto;Â 
Â  Â  Â  Â  background: #f4f4f4;Â 
Â  Â  Â  Â  max-width: 1200px;Â 
Â  Â  Â  Â  padding: 0 20px;Â 
Â  Â  }
Â  Â Â 
Â  Â  h1 { color: #333; }
Â  Â  .section { margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 8px; }
Â  Â  input, textarea, select { margin: 5px 0; padding: 8px; width: 100%; }
Â  Â Â 
Â  Â  /* === ESTILOS PARA EL ENCABEZADO Y BOTÃ“N SALIR === */
Â  Â  .header-container {
Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  justify-content: space-between;Â 
Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  margin-bottom: 10px;Â 
Â  Â  }
Â  Â  .logout-btn {
Â  Â  Â  Â  background: #d32f2f; /* Rojo para el botÃ³n de salir */
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  padding: 8px 12px;
Â  Â  }
Â  Â  .logout-btn:hover {
Â  Â  Â  Â  opacity: 0.8;
Â  Â  }
Â  Â  /* ======================================================= */

Â  Â  /* Estilo para el botÃ³n de Google */
Â  Â  .google-btn {Â 
Â  Â  Â  Â  padding: 10px 15px;Â 
Â  Â  Â  Â  margin: 5px 5px 0 0;Â 
Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  border-radius: 5px;Â 
Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  background: #db4437; /* Rojo de Google */
Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  .google-btn:hover { opacity: 0.9; }
Â  Â  /* Estilo para los botones generales (Agregar Tarea, Exportar, etc.) */
Â  Â  button { padding: 10px 15px; margin: 5px 5px 0 0; border: none; border-radius: 5px; cursor: pointer; background: #1976d2; color: white; }
Â  Â  button:hover { opacity: 0.9; }
Â  Â Â 
Â  Â  ul { list-style-type: none; padding: 0; }
Â  Â  li {Â 
Â  Â  Â  Â  margin: 5px 0;Â 
Â  Â  Â  Â  padding: 5px;Â 
Â  Â  Â  Â  background: #eaeaea;Â 
Â  Â  Â  Â  border-radius: 5px;Â 
Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  white-space: normal;Â 
Â  Â  }
Â  Â  .completed { text-decoration: line-through; color: gray; }
Â  Â  .calendar { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }Â 
Â  Â  .day { background: #ddd; padding: 10px; border-radius: 5px; min-height: 60px; }
Â  Â Â 
Â  Â  .current-day {
Â  Â  Â  Â  background-color: #b0b0b0 !important;
Â  Â  Â  Â  border: 2px solid #555;
Â  Â  }
Â  Â Â 
Â  Â  .stats { font-weight: bold; margin-top: 10px; }
Â  Â Â 
Â  Â  .task-buttons {Â 
Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  gap: 10px;Â 
Â  Â  Â  Â  flex-wrap: wrap;Â 
Â  Â  Â  Â  margin-top: 10px;Â 
Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  justify-content: space-between;Â 
Â  Â  }
Â  Â  #deleteBtn {
Â  Â  Â  Â  margin-left: auto;Â 
Â  Â  }
Â  Â Â 
Â  Â  .urgent-tag {
Â  Â  Â  Â  color: red;
Â  Â  Â  Â  font-weight: bold;
Â  Â  }

    /* --- ESTILOS PARA EL POPUP DE ALERTA (NUEVO) --- */
    .alert-modal {
        display: none; /* Oculto por defecto */
        position: fixed;
        z-index: 1000; /* Asegura que estÃ© por encima de todo */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4); /* Fondo semi-transparente */
    }

    .alert-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% arriba y centrado */
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px; /* Ancho mÃ¡ximo para mejor visualizaciÃ³n */
        border-radius: 10px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    }

    .alert-content h3 {
        color: #d32f2f; /* Rojo de alerta */
        margin-top: 0;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
    }

    .alert-content ul {
        list-style-type: disc;
        margin-left: 20px;
        max-height: 200px;
        overflow-y: auto;
        padding-right: 10px;
    }

    .alert-content li {
        background: none;
        padding: 5px 0;
        margin: 2px 0;
        border-bottom: 1px dotted #ccc;
        cursor: default;
    }

    .alert-close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .alert-close:hover,
    .alert-close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    /* ------------------------------------------- */
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>Â 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
Â  Â  function mostrarFechaHora() {
Â  Â  Â  Â  const ahora = new Date();
Â  Â  Â  Â  const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
Â  Â  Â  Â  const fecha = ahora.toLocaleDateString('es-ES', opciones);
Â  Â  Â  Â  const hora = ahora.toLocaleTimeString('es-ES');
Â  Â  Â  Â  document.getElementById("fecha-hora").innerHTML = `${fecha} - ${hora}`;
Â  Â  }
Â  Â  setInterval(mostrarFechaHora, 1000);
</script>
</head>
<body>
Â  Â  <div id="loginSection" class="section" style="max-width: 400px; margin: 50px auto; display: block;">
Â  Â  Â  Â  <h2>ğŸ”’ Iniciar SesiÃ³n</h2>
Â  Â  Â  Â  <p>Usa tu cuenta de Google (la misma que usas en Firebase) para acceder.</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button onclick="handleLogin()" class="google-btn">
Â  Â  Â  Â  Â  Â  ğŸš€ Iniciar SesiÃ³n con Google
Â  Â  Â  Â  </button>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <p id="authMessage" style="color:red; margin-top:10px;"></p>
Â  Â  </div>
Â  Â  <div id="mainContent" style="display: none;">
Â  Â Â 
Â  Â  <div class="header-container">
Â  Â  Â  Â  <h1>ğŸ—“ï¸ Asistente Diario - PVergaraA</h1>
Â  Â  Â  Â  <button onclick="logout()" class="logout-btn">
Â  Â  Â  Â  Â  Â  ğŸšª Salir
Â  Â  Â  Â  </button>Â 
Â  Â  </div>
Â  Â  <p id="fecha-hora"></p>


Â  Â  <div class="section">
Â  Â  Â  Â  <h2>âœ… Tareas</h2>
Â  Â  Â  Â  <input id="taskInput" placeholder="Escribe una tarea..." type="text"/>
Â  Â  Â  Â  <select id="taskTag">
Â  Â  Â  Â  Â  Â  <option value="">Etiqueta</option>
Â  Â  Â  Â  Â  Â  <option value="Urgente">Urgente</option>
Â  Â  Â  Â  Â  Â  <option value="ReuniÃ³n">ReuniÃ³n</option>
Â  Â  Â  Â  Â  Â  <option value="Pendiente">Pendiente</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <input id="taskDate" type="date"/>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="task-buttons">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="addTask()">Agregar tarea</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="startDictation()">ğŸ™ï¸ Comenzar dictado</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="exportTasks()">Exportar tareas</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="deleteBtn" style="background:#d32f2f" onclick="deleteCompletedTasks()">ğŸ—‘ï¸ Borrar tareas completadas</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <p id="recordingTimer" style="margin-top: 10px;">â±ï¸ Tiempo de grabaciÃ³n: 0 segundos</p>
Â  Â  Â  Â  <p id="statusMessage" style="color: blue;">Esperando inicio de sesiÃ³n...</p>

Â  Â  Â  Â  <ul id="taskList"></ul>
Â  Â  Â  Â  <p class="stats" id="taskStats"></p>
Â  Â  </div>

Â  Â  <section id="buscador" class="section">
Â  Â  Â  Â  <h2 class="text-xl font-semibold mb-2">Buscar tareas</h2>
Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  id="searchInput"
Â  Â  Â  Â  Â  Â  placeholder="Escribe para buscar..."
Â  Â  Â  Â  Â  Â  class="flex-1 border p-2 rounded"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="searchBtn"
Â  Â  Â  Â  Â  Â  class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Buscar
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  id="clearSearchBtn"
Â  Â  Â  Â  Â  Â  class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Limpiar
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="searchResults" class="mt-4"></div>
Â  Â  </section>

Â  Â  <div class="section">
Â  Â  Â  Â  <h2>ğŸ“… Calendario de tareas</h2>
Â  Â  Â  Â  <div class="calendar" id="calendarView"></div>
Â  Â  </div>
Â  Â Â 
</div>

<div id="taskAlertModal" class="alert-modal">
    <div class="alert-content">
        <span class="alert-close" onclick="closeAlertModal()">&times;</span>
        <h3>ğŸ”” Tareas PrÃ³ximas o de Hoy</h3>
        <p id="alertMessageHeader"></p>
        <ul id="alertTaskList">
            </ul>
        <button onclick="closeAlertModal()" style="margin-top: 15px;">Entendido</button>
    </div>
</div>
<script>
Â  Â  // ----------------------------------------------------------------------
Â  Â  // âš™ï¸ CONFIGURACIÃ“N E INICIALIZACIÃ“N DE FIREBASE (TUS DATOS REALES) âš™ï¸
Â  Â  // ----------------------------------------------------------------------
Â  Â Â 
Â  Â  const firebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyAh1g7i3vI37nSQYkUi1gSKstRvLIrCVOY",
Â  Â  Â  Â  authDomain: "asistenteweb-d1a36.firebaseapp.com",
Â  Â  Â  Â  projectId: "asistenteweb-d1a36",
Â  Â  Â  Â  storageBucket: "asistenteweb-d1a36.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "300972571463",
Â  Â  Â  Â  appId: "1:300972571463:web:b2259fb2eac4b7bae12a62"
Â  Â  };

Â  Â  // ColecciÃ³n y Documento Fijo para todas las tareas
Â  Â  const COLLECTION_NAME = "users";
Â  Â  const DOCUMENT_ID = "asistente_master_tasks";Â 

Â  Â  // Inicializar Firebase con el SDK de compatibilidad (V8 style)
Â  Â  const app = firebase.initializeApp(firebaseConfig);
Â  Â  const db = app.firestore();Â 
Â  Â  const auth = app.auth();Â 

Â  Â  // ----------------------------------------------------------------------
Â  Â  // ğŸ”’ FUNCIONES DE AUTENTICACIÃ“N Y CONTROL DE VISTA ğŸ”’
Â  Â  // ----------------------------------------------------------------------
Â  Â  const loginSection = document.getElementById('loginSection');
Â  Â  const mainContent = document.getElementById('mainContent');
Â  Â  const authMessage = document.getElementById('authMessage');

Â  Â  // FUNCIÃ“N DE INICIO DE SESIÃ“N CON GOOGLE
Â  Â  function handleLogin() {
Â  Â  Â  Â  const provider = new firebase.auth.GoogleAuthProvider();
Â  Â  Â  Â Â 
Â  Â  Â  Â  auth.signInWithPopup(provider)
Â  Â  Â  Â  Â  Â  .catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  authMessage.innerText = `Error de ingreso con Google: ${error.message}`;
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  // FUNCIÃ“N DE CIERRE DE SESIÃ“N
Â  Â  function logout() {
Â  Â  Â  Â  auth.signOut().then(() => {
Â  Â  Â  Â  Â  Â  console.log("SesiÃ³n cerrada.");
Â  Â  Â  Â  }).catch((error) => {
Â  Â  Â  Â  Â  Â  console.error("Error al cerrar sesiÃ³n: ", error);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Escucha el estado de autenticaciÃ³n (el motor de seguridad de la vista)
Â  Â  auth.onAuthStateChanged(user => {
Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  // USUARIO LOGUEADO
Â  Â  Â  Â  Â  Â  loginSection.style.display = 'none';
Â  Â  Â  Â  Â  Â  mainContent.style.display = 'block';
Â  Â  Â  Â  Â  Â  authMessage.innerText = '';
Â  Â  Â  Â  Â  Â  loadTasksFromCloud();Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // USUARIO DESLOGUEADO
Â  Â  Â  Â  Â  Â  // ğŸ’¡ ESTA LÃNEA FUE CORREGIDA (de loginContent a loginSection)
Â  Â  Â  Â  Â  Â  loginSection.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  mainContent.style.display = 'none';
Â  Â  Â  Â  Â  Â  tasks = [];
Â  Â  Â  Â  Â  Â  renderTasks();
Â  Â  Â  Â  Â  Â  renderCalendar();
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // ----------------------------------------------------------------------
Â  Â  // â˜ï¸ FUNCIONES DE SINCRONIZACIÃ“N EN LA NUBE CON FIREBASE â˜ï¸
Â  Â  // ----------------------------------------------------------------------

Â  Â  let tasks = [];Â 
Â  Â  const statusMessage = document.getElementById('statusMessage');

Â  Â  async function saveTasksToCloud() {
Â  Â  Â  Â  if (!auth.currentUser) {
Â  Â  Â  Â  Â  Â  statusMessage.innerText = "ğŸš¨ Error: Debes iniciar sesiÃ³n para guardar.";
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  statusMessage.innerText = "Guardando...";
Â  Â  Â  Â  Â  Â  await db.collection(COLLECTION_NAME).doc(DOCUMENT_ID).set({ tasks });
Â  Â  Â  Â  Â  Â  console.log("Tareas guardadas en Firebase.");
Â  Â  Â  Â  Â  Â  statusMessage.innerText = "Guardado en la nube.";
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Error al guardar en la nube: ", e);
Â  Â  Â  Â  Â  Â  statusMessage.innerText = `ğŸš¨ Error al guardar: ${e.code || e.message}`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function loadTasksFromCloud() {
Â  Â  Â  Â  if (!auth.currentUser) {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  statusMessage.innerText = "Cargando...";
Â  Â  Â  Â  Â  Â  const docSnap = await db.collection(COLLECTION_NAME).doc(DOCUMENT_ID).get();

Â  Â  Â  Â  Â  Â  if (docSnap.exists) {
Â  Â  Â  Â  Â  Â  Â  Â  tasks = docSnap.data().tasks || [];Â 
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.innerText = "Cargado desde la nube.";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  tasks = [];Â 
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.innerText = "Listo (documento inicializado).";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Error al cargar desde la nube: ", e);
Â  Â  Â  Â  Â  Â  tasks = [];
Â  Â  Â  Â  Â  Â  statusMessage.innerText = `ğŸš¨ Error de conexiÃ³n/reglas de Firebase: ${e.code || e.message}.`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  renderTasks();
Â  Â  Â  Â  renderCalendar();
Â  Â  Â  Â  // ğŸŒŸ Â¡LLAMADA A LA NUEVA FUNCIÃ“N DE ALERTA!
Â  Â  Â  Â  checkForAlerts(); 
Â  Â  }
Â  Â Â 
Â  Â  function saveData() {
Â  Â  Â  Â  saveTasksToCloud();Â 
Â  Â  }
Â  Â Â 
Â  Â  // ----------------------------------------------------------------------
Â  Â  // ---- RESTO DE FUNCIONES (Tu lÃ³gica de la app) ----
Â  Â  // ----------------------------------------------------------------------
Â  Â Â 
Â  Â  function addTask(text = null) {
Â  Â  Â  Â  const taskInput = document.getElementById('taskInput');
Â  Â  Â  Â  const taskDateInput = document.getElementById('taskDate');Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const taskText = text || taskInput.value;
Â  Â  Â  Â  const tag = document.getElementById('taskTag').value;
Â  Â  Â  Â  const date = taskDateInput.value;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (taskText.trim()) {
Â  Â  Â  Â  Â  Â  tasks.push({ text: taskText.trim(), tag, date, done: false });
Â  Â  Â  Â  Â  Â  saveData();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!text) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â taskInput.value = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  taskDateInput.value = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  renderTasks();
Â  Â  Â  Â  Â  Â  renderCalendar();
Â  Â  Â  Â  Â  Â  // ğŸŒŸ OpciÃ³n: Recargar alertas si se aÃ±ade una tarea nueva
Â  Â  Â  Â  Â  Â  // checkForAlerts(); 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function toggleTask(index) {
Â  Â  Â  Â  tasks[index].done = !tasks[index].done;
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  renderTasks();
Â  Â  Â  Â  renderCalendar();
Â  Â  Â  Â  // ğŸŒŸ OpciÃ³n: Recargar alertas si se marca una tarea
Â  Â  Â  Â  // checkForAlerts(); 
Â  Â  }

Â  Â  function deleteCompletedTasks() {
Â  Â  Â  Â  tasks = tasks.filter(t => !t.done);
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  renderTasks();
Â  Â  Â  Â  renderCalendar();
Â  Â  }

Â  Â  function renderTasks() {
Â  Â  Â  Â  const list = document.getElementById('taskList');
Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const totalTasks = tasks.length;
Â  Â  Â  Â  const reversedTasks = [...tasks].reverse();Â 

Â  Â  Â  Â  reversedTasks.forEach((task, i) => {
Â  Â  Â  Â  Â  Â  const originalIndex = totalTasks - 1 - i;Â 
Â  Â  Â  Â  Â  Â  const taskNumber = i + 1;Â 

Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  li.className = task.done ? 'completed' : '';
Â  Â  Â  Â  Â  Â  li.onclick = () => toggleTask(originalIndex);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const tagText = task.tag || 'Sin etiqueta';
Â  Â  Â  Â  Â  Â  let styledTag = tagText;

Â  Â  Â  Â  Â  Â  if (tagText === 'Urgente') {
Â  Â  Â  Â  Â  Â  Â  Â  styledTag = `<span class="urgent-tag">${tagText}</span>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  li.innerHTML = `${taskNumber}. ${task.text} (${styledTag}) - ${task.date || 'Sin fecha'}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  const completed = tasks.filter(t => t.done).length;
Â  Â  Â  Â  document.getElementById('taskStats').innerText = `Completadas: ${completed} / Pendientes: ${totalTasks - completed}`;
Â  Â  }
Â  Â Â 
Â  Â  function exportTasks() {
Â  Â  Â  Â  if (tasks.length === 0) {
Â  Â  Â  Â  Â  Â  alert("No hay tareas para exportar.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  const doc = new jsPDF();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let y = 10;Â 
Â  Â  Â  Â  const lineHeight = 7;
Â  Â  Â  Â  const pageWidth = doc.internal.pageSize.getWidth();
Â  Â  Â  Â  const margin = 10;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const title = "REPORTE DE TAREAS ASISTENTE DIARIO";
Â  Â  Â  Â  doc.setFontSize(16);
Â  Â  Â  Â  doc.text(title, pageWidth / 2, y, { align: 'center' });
Â  Â  Â  Â  y += lineHeight * 2;
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc.setFontSize(10);
Â  Â  Â  Â  doc.setFont(doc.getFont().fontName, 'normal');

Â  Â  Â  Â  tasks.forEach((t, index) => {
Â  Â  Â  Â  Â  Â  const status = t.done ? '[COMPLETADA]' : '[PENDIENTE]';
Â  Â  Â  Â  Â  Â  const tag = t.tag ? ` | Etiqueta: ${t.tag}` : '';
Â  Â  Â  Â  Â  Â  const date = t.date ? ` | Fecha: ${t.date}` : '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const color = t.done ? [128, 128, 128] : [0, 0, 0];Â 
Â  Â  Â  Â  Â  Â  doc.setTextColor(...color);

Â  Â  Â  Â  Â  Â  const textLine = `${index + 1}. ${status} ${t.text}${tag}${date}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (y + lineHeight > doc.internal.pageSize.getHeight() - margin) {
Â  Â  Â  Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  y = margin;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  doc.text(textLine, margin, y);
Â  Â  Â  Â  Â  Â  y += lineHeight;
Â  Â  Â  Â  });

Â  Â  Â  Â  doc.save("Reporte_Tareas_" + new Date().toISOString().slice(0, 10) + ".pdf");
Â  Â  }

Â  Â  let recordingInterval;
Â  Â  let recordingSeconds = 0;

Â  Â  function startDictation() {
Â  Â  Â  Â  if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
Â  Â  Â  Â  Â  Â  alert('El reconocimiento de voz no estÃ¡ soportado por tu navegador. Prueba con Chrome o Edge.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
Â  Â  Â  Â  recognition.lang = 'es-ES';
Â  Â  Â  Â  recognition.interimResults = false;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.onstart = function() {
Â  Â  Â  Â  Â  Â  recordingSeconds = 0;
Â  Â  Â  Â  Â  Â  document.getElementById('recordingTimer').innerText = "ğŸ™ï¸ ESCUCHANDO... (0 segundos)";
Â  Â  Â  Â  Â  Â  recordingInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  recordingSeconds++;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('recordingTimer').innerText = `ğŸ™ï¸ ESCUCHANDO... (${recordingSeconds} segundos)`;
Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.onresult = function(event) {
Â  Â  Â  Â  Â  Â  const transcript = event.results[0][0].transcript;
Â  Â  Â  Â  Â  Â  addTask("ğŸ—£ï¸ TAREA DICTADA: " + transcript);Â 
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.onerror = function(event) {Â 
Â  Â  Â  Â  Â  Â  clearInterval(recordingInterval);Â 
Â  Â  Â  Â  Â  Â  document.getElementById('recordingTimer').innerText = `âŒ Error en el dictado: ${event.error}`;
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.onend = function() {Â 
Â  Â  Â  Â  Â  Â  clearInterval(recordingInterval);Â 
Â  Â  Â  Â  Â  Â  document.getElementById('recordingTimer').innerText = `â±ï¸ Dictado finalizado. ${recordingSeconds} segundos`;
Â  Â  Â  Â  };

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â recognition.start();
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â clearInterval(recordingInterval);Â 
Â  Â  Â  Â  Â  Â  Â document.getElementById('recordingTimer').innerText = "Error al iniciar el dictado. Es posible que ya estÃ© activo.";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderCalendar() {
Â  Â  Â  Â  const calendar = document.getElementById('calendarView');
Â  Â  Â  Â  calendar.innerHTML = '';
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  const year = today.getFullYear();
Â  Â  Â  Â  const month = today.getMonth();
Â  Â  Â  Â  const daysInMonth = new Date(year, month + 1, 0).getDate();
Â  Â  Â  Â Â 
Â  Â  Â  Â  const todayStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const dayNames = ['Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes'];
Â  Â  Â  Â Â 
Â  Â  Â  Â  calendar.style.gridTemplateColumns = 'repeat(5, 1fr)';Â 

Â  Â  Â  Â  dayNames.forEach(name => {
Â  Â  Â  Â  Â  Â  const header = document.createElement('div');
Â  Â  Â  Â  Â  Â  header.className = 'day-header';
Â  Â  Â  Â  Â  Â  header.style.fontWeight = 'bold';
Â  Â  Â  Â  Â  Â  header.style.textAlign = 'center';
Â  Â  Â  Â  Â  Â  header.innerText = name;Â 
Â  Â  Â  Â  Â  Â  calendar.appendChild(header);
Â  Â  Â  Â  });

Â  Â  Â  Â  let firstDayOfMonth = new Date(year, month, 1).getDay();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (firstDayOfMonth === 0) firstDayOfMonth = 7;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (firstDayOfMonth >= 1 && firstDayOfMonth <= 5) {
Â  Â  Â  Â  Â  Â  for (let i = 1; i < firstDayOfMonth; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const emptyDay = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  emptyDay.className = 'day';
Â  Â  Â  Â  Â  Â  Â  Â  emptyDay.style.background = '#f4f4f4';
Â  Â  Â  Â  Â  Â  Â  Â  emptyDay.style.border = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  calendar.appendChild(emptyDay);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 

Â  Â  Â  Â  for (let d = 1; d <= daysInMonth; d++) {
Â  Â  Â  Â  Â  Â  const dateObj = new Date(year, month, d);
Â  Â  Â  Â  Â  Â  const dayOfWeek = dateObj.getDay();Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (dayOfWeek === 0 || dayOfWeek === 6) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  continue;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const monthStr = String(month + 1).padStart(2, '0');
Â  Â  Â  Â  Â  Â  const dayStr = String(d).padStart(2, '0');
Â  Â  Â  Â  Â  Â  const dateStr = `${year}-${monthStr}-${dayStr}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dayDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  dayDiv.className = 'day';

Â  Â  Â  Â  Â  Â  if (dateStr === todayStr) {
Â  Â  Â  Â  Â  Â  Â  Â  dayDiv.classList.add('current-day');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const dayNameIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1;Â 
Â  Â  Â  Â  Â  Â  const dayNameShort = dayNames[dayNameIndex] ? dayNames[dayNameIndex].substring(0, 3) : '';
Â  Â  Â  Â  Â  Â  dayDiv.innerHTML = `<strong>${dayNameShort} ${d}</strong><br>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tasks.filter(t => t.date === dateStr).forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  Â  Â  p.innerText = t.text;
Â  Â  Â  Â  Â  Â  Â  Â  p.style.fontSize = '12px';
Â  Â  Â  Â  Â  Â  Â  Â  p.style.color = t.done ? 'gray' : '#333';
Â  Â  Â  Â  Â  Â  Â  Â  p.style.textDecoration = t.done ? 'line-through' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â  dayDiv.appendChild(p);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  calendar.appendChild(dayDiv);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function searchItems() {
Â  Â  Â  Â  const query = document.getElementById('searchInput').value.toLowerCase();
Â  Â  Â  Â  const results = document.getElementById('searchResults');
Â  Â  Â  Â  results.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (query.trim() === "") {
Â  Â  Â  Â  Â  Â  results.innerHTML = '<p>Por favor, ingrese un tÃ©rmino de bÃºsqueda.</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const foundTasks = tasks.filter(t =>Â 
Â  Â  Â  Â  Â  Â  t.text.toLowerCase().includes(query) ||Â 
Â  Â  Â  Â  Â  Â  (t.tag && t.tag.toLowerCase().includes(query))
Â  Â  Â  Â  );
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (foundTasks.length > 0) {
Â  Â  Â  Â  Â  Â  foundTasks.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  li.innerText = `TAREA: ${t.text} (${t.tag || 'Sin etiqueta'}) - ${t.date || 'Sin fecha'}`;
Â  Â  Â  Â  Â  Â  Â  Â  li.className = t.done ? 'completed' : '';
Â  Â  Â  Â  Â  Â  Â  Â  results.appendChild(li);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  results.innerHTML = '<p>No se encontraron tareas con ese criterio.</p>';
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // ----------------------------------------------------------------------
Â  Â  // ğŸ”” FUNCIONES PARA LA ALERTA (NUEVAS) ğŸ””
Â  Â  // ----------------------------------------------------------------------

Â  Â  function closeAlertModal() {
Â  Â  Â  Â  document.getElementById('taskAlertModal').style.display = 'none';
Â  Â  }

Â  Â  function checkForAlerts() {
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  const todayStr = today.toISOString().slice(0, 10); // YYYY-MM-DD
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Calcula la fecha de maÃ±ana (para tareas del dÃ­a siguiente)
Â  Â  Â  Â  const tomorrow = new Date(today);
Â  Â  Â  Â  tomorrow.setDate(today.getDate() + 1);
Â  Â  Â  Â  const tomorrowStr = tomorrow.toISOString().slice(0, 10);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Filtra las tareas pendientes (done: false) con fecha en hoy o maÃ±ana
Â  Â  Â  Â  const pendingAlerts = tasks.filter(t => 
Â  Â  Â  Â  Â  Â  !t.done && (t.date === todayStr || t.date === tomorrowStr)
Â  Â  Â  Â  ).sort((a, b) => {
Â  Â  Â  Â  Â  Â  // Ordena: Primero las de hoy, luego las de maÃ±ana
Â  Â  Â  Â  Â  Â  if (a.date === todayStr && b.date === tomorrowStr) return -1;
Â  Â  Â  Â  Â  Â  if (a.date === tomorrowStr && b.date === todayStr) return 1;
Â  Â  Â  Â  Â  Â  return 0;
Â  Â  Â  Â  });

Â  Â  Â  Â  if (pendingAlerts.length > 0) {
Â  Â  Â  Â  Â  Â  const list = document.getElementById('alertTaskList');
Â  Â  Â  Â  Â  Â  const header = document.getElementById('alertMessageHeader');
Â  Â  Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let todayCount = 0;
Â  Â  Â  Â  Â  Â  let tomorrowCount = 0;

Â  Â  Â  Â  Â  Â  pendingAlerts.forEach(task => {
Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  const dateDisplay = task.date === todayStr ? 'HOY' : 'MAÃ‘ANA';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (task.date === todayStr) todayCount++;
Â  Â  Â  Â  Â  Â  Â  Â  if (task.date === tomorrowStr) tomorrowCount++;

Â  Â  Â  Â  Â  Â  Â  Â  let text = `${dateDisplay} (${task.date}): ${task.text}`;
Â  Â  Â  Â  Â  Â  Â  Â  if (task.tag === 'Urgente') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = `âš ï¸ Â¡URGENTE! ${text}`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  li.innerText = text;
Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Crea un mensaje de encabezado mÃ¡s informativo
Â  Â  Â  Â  Â  Â  let headerText = "Tienes ";
Â  Â  Â  Â  Â  Â  if (todayCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  headerText += `<span style="font-weight: bold; color: #d32f2f;">${todayCount} tarea(s) para HOY</span>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (todayCount > 0 && tomorrowCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  headerText += " y ";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (tomorrowCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  headerText += `<span style="font-weight: bold; color: #1976d2;">${tomorrowCount} tarea(s) para MAÃ‘ANA</span>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  header.innerHTML = headerText;

Â  Â  Â  Â  Â  Â  // Muestra el modal
Â  Â  Â  Â  Â  Â  document.getElementById('taskAlertModal').style.display = 'block';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ---- MANEJO DEL BUSCADOR ----
Â  Â  const searchInput = document.getElementById("searchInput");
Â  Â  const searchResults = document.getElementById("searchResults");
Â  Â  const clearSearchBtn = document.getElementById("clearSearchBtn");
Â  Â  const searchBtn = document.getElementById('searchBtn');

Â  Â  searchBtn.addEventListener('click', searchItems);

Â  Â  clearSearchBtn.addEventListener("click", () => {
Â  Â  Â  searchInput.value = "";
Â  Â  Â  searchResults.innerHTML = "";
Â  Â  Â  if(auth.currentUser) {Â 
Â  Â  Â  Â  loadTasksFromCloud();Â 
Â  Â  Â  }
Â  Â  });
</script>
</body>
</html>
